knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
library(ggplot2)
library(raster)
library(agricolae)
library(tidyr)
library(ggpubr)
library(dplyr)
library(tidyverse)
library(data.table)
library(vegan)
library(lme4)
library(lmerTest)
df_NC = read_csv('C:/Users/theox/Desktop/Projects/SoilFingerPrints/Data/2022/Nematode_morpho/Nematode_raw_22.csv')
df_NC[c("Sites", "pair", "location", "FieldType")] <- lapply(df_NC[c("Sites", "pair", "location", "FieldType")],
factor)
df_NC$FieldType = gsub('Field', "", df_NC$FieldType)
df_NC$FieldType = gsub('field', "", df_NC$FieldType)
df_NC$FieldType = gsub('Non-virgin ', "Non-virgin", df_NC$FieldType)
df_NC$FieldType = gsub('Virgin ', "Virgin", df_NC$FieldType)
df_NC$location = gsub('columbia Basin', 'Columbia Basin', df_NC$location)
unique(df_NC$FieldType)
unique(df_NC$location)
df_taxa = df_NC[-c(1,2,3,4)]
labels = df_NC[c(1,2,3,4)]
dim(df_NC)
library(phyloseq)
library(DESeq2)
library(phyloseq)
library('picante')
#Subsample reads
count_tab_phy <- otu_table(df_taxa, taxa_are_rows=F)
ps_rare <- rarefy_even_depth(count_tab_phy, rngseed = 123, replace = FALSE)
dim(ps_rare)
log_rare= log2(ps_rare +1)
shannon = phyloseq::estimate_richness(log_rare, measures = "Shannon")
#observed = phyloseq::estimate_richness(count_tab_phy, measures = "Observed")
diversity = cbind(shannon, labels)
head(diversity)
options(repr.plot.width = 5, repr.plot.height = 20)
#jpeg('Alpha diveristy.jpg',width=5,height=3,units='in',res=300)
b= ggplot(data = diversity, aes(x =FieldType, y = Shannon, color = FieldType))+
geom_boxplot(outlier.color = NA)+
geom_jitter(aes(color = FieldType), height = 0, width = .2)+
labs(x = 'Field Type', y="Shannon's diversity index") +
theme(legend.position = "none")+
theme(axis.title.x= element_blank(),
axis.title.y = element_text(size =10, color ='black'),
axis.text.x = element_text(size =10, color ='black'),
axis.text.y = element_text(size =8, color = 'black'))+
scale_color_manual(name = 'Field Type', labels = c('Native', 'Non-Virgin', 'Virgin'),
values = c('tomato', 'orange', 'chartreuse4'))+facet_wrap(~ location)
b
#dev.off()
#Generate distance matrix
clr_dist_matrix <- phyloseq::distance(log_rare, method = "euclidean")
#ADONIS test
adon.results<-adonis(clr_dist_matrix ~ labels$FieldType, strata = labels$location)
adon.results$aov.tab
vst_pcoa$vectors
# generating and visualizing the PCoA with phyloseq
vst_pcoa <- ordinate(log_rare, method="MDS", distance="euclidean")
eigen_vals <- vst_pcoa$values$Eigenvalue
vst_pcoa$vectors
dim(vst_pcoa$vectors)
df_PCA = vst_pcoa$vectors
cbind(labels, df_PCA)
ggplot(df_PCA, aes(x = Axis.1, y = Axis.2, color = FieldType))+
geom_point()
df_PCA = as.data.frame(cbind(labels, df_PCA))
ggplot(df_PCA, aes(x = Axis.1, y = Axis.2, color = FieldType))+
geom_point()
ggplot(df_PCA, aes(x = Axis.1, y = Axis.2, color = FieldType, shape = location))+
geom_point()
ggplot(df_PCA, aes(x = Axis.1, y = Axis.2, color = FieldType, shape = location))+
geom_point(size = 5)
ggplot(df_PCA, aes(x = Axis.1, y = Axis.2, color = FieldType, shape = location))+
geom_point(size = 3)
metaMDS(log_rare, distance = 'bray')
df_nmds = metaMDS(log_rare, distance = 'bray')
df_nmds
ord = metaMDS(log_rare, distance = 'bray')
plot(ord)
ord[,1]
ord = metaMDS(log_rare, distance = 'bray')
ord[,1]
plot(ord[,1], ord[,2])
ord$points
ord$points[,1]
ord = metaMDS(log_rare, distance = 'bray')
ggplot(labels, aes(x = ord$points[,1], y = ord$points[,2], color = FieldType, shape = location))+
geom_point(size = 3)
ord = metaMDS(log_rare, distance = 'bray')
ggplot(labels, aes(x = ord$points[,1], y = ord$points[,2], color = FieldType, shape = location))+
geom_point(size = 3)+facet_wrap(~location)
ggplot(labels, aes(x = ord$points[,1], y = ord$points[,2], color = FieldType))+
geom_point(size = 3)+facet_wrap(~location)+
```
ggplot(labels, aes(x = ord$points[,1], y = ord$points[,2], color = FieldType))+
geom_point(size = 3)+facet_wrap(~location)+
```
ggplot(labels, aes(x = ord$points[,1], y = ord$points[,2], color = FieldType))+
geom_point(size = 3)+facet_wrap(~location)
ggplot(labels, aes(x = ord$points[,1], y = ord$points[,2], color = FieldType, label= pair))+
geom_point(size = 3)++
geom_text()+
facet_wrap(~location)
ggplot(labels, aes(x = ord$points[,1], y = ord$points[,2], color = FieldType, label= pair))+
geom_point(size = 3)+
geom_text()+
facet_wrap(~location)
ord = metaMDS(log_rare, distance = 'bray')
ggplot(labels, aes(x = ord$points[,1], y = ord$points[,2], color = FieldType, label= pair))+
geom_point(size = 3)+
geom_text(overlap = T)+
facet_wrap(~location)
ord = metaMDS(log_rare, distance = 'bray')
ggplot(labels, aes(x = ord$points[,1], y = ord$points[,2], color = FieldType, label= pair))+
geom_point(size = 3)+
geom_text(overlap = F)+
facet_wrap(~location)
ord = metaMDS(log_rare, distance = 'bray')
ggplot(labels, aes(x = ord$points[,1], y = ord$points[,2], color = FieldType, label= pair))+
geom_point(size = 0.1)+
geom_text(overlap = F)+
facet_wrap(~location)
ord = metaMDS(log_rare, distance = 'bray')
ggplot(labels, aes(x = ord$points[,1], y = ord$points[,2], color = FieldType, label= pair))+
geom_point(size = 0.1)+
geom_text(overlap = F)+
scale_color_manual(name = 'Field Type', labels = c('Native', 'Non-virgin', 'Virgin'),
values = c('tomato', 'orange', 'chartreuse4'))+
facet_wrap(~location)
ggplot(labels, aes(x = ord$points[,1], y = ord$points[,2], color = FieldType, label= pair))+
geom_point(size = 0.1)+
geom_text(overlap = F)+
labs(x = 'NMDS 1', y="NMDS 2") +
theme_bw()+
scale_color_manual(name = 'Field Type', labels = c('Native', 'Non-virgin', 'Virgin'),
values = c('tomato', 'orange', 'chartreuse4'))+
facet_wrap(~location)
ord = metaMDS(log_rare, distance = 'bray')
options(repr.plot.width = 5, repr.plot.height = 3)
#jpeg('Tuberwt_gt20_222_combinedlocations.jpg',width=5,height=3,units='in',res=300)
beta = ggplot(labels, aes(x = ord$points[,1], y = ord$points[,2], color = FieldType, label= pair))+
geom_point(size = 0.1)+
geom_text(overlap = F)+
labs(x = 'NMDS 1', y="NMDS 2") +
theme(axis.title.x= element_blank(),
axis.title.y = element_text(size =10, color ='black'),
axis.text.x = element_text(size =10, color ='black'),
axis.text.y = element_text(size =8, color = 'black'))+
theme_bw()+
scale_color_manual(name = 'Field Type', labels = c('Native', 'Non-virgin', 'Virgin'),
values = c('tomato', 'orange', 'chartreuse4'))+
facet_wrap(~location)
beta
#dev.off()
ord = metaMDS(log_rare, distance = 'bray')
options(repr.plot.width = 5, repr.plot.height = 3)
#jpeg('Tuberwt_gt20_222_combinedlocations.jpg',width=5,height=3,units='in',res=300)
beta = ggplot(labels, aes(x = ord$points[,1], y = ord$points[,2], color = FieldType))+
geom_point(size = 0.1)+
labs(x = 'NMDS 1', y="NMDS 2") +
theme(axis.title.x= element_blank(),
axis.title.y = element_text(size =10, color ='black'),
axis.text.x = element_text(size =10, color ='black'),
axis.text.y = element_text(size =8, color = 'black'))+
theme_bw()+
scale_color_manual(name = 'Field Type', labels = c('Native', 'Non-virgin', 'Virgin'),
values = c('tomato', 'orange', 'chartreuse4'))+
facet_wrap(~location)
beta
#dev.off()
beta
ord = metaMDS(log_rare, distance = 'bray')
options(repr.plot.width = 5, repr.plot.height = 3)
#jpeg('Tuberwt_gt20_222_combinedlocations.jpg',width=5,height=3,units='in',res=300)
beta = ggplot(labels, aes(x = ord$points[,1], y = ord$points[,2], color = FieldType))+
geom_point(size = 2)+
labs(x = 'NMDS 1', y="NMDS 2") +
theme(axis.title.x= element_blank(),
axis.title.y = element_text(size =10, color ='black'),
axis.text.x = element_text(size =10, color ='black'),
axis.text.y = element_text(size =8, color = 'black'))+
theme_bw()+
scale_color_manual(name = 'Field Type', labels = c('Native', 'Non-virgin', 'Virgin'),
values = c('tomato', 'orange', 'chartreuse4'))+
facet_wrap(~location)
beta
#dev.off()
beta
beta = ggplot(labels, aes(x = ord$points[,1], y = ord$points[,2], color = FieldType))+
geom_point(size = 2)+
labs(x = 'NMDS 1', y="NMDS 2") +
theme(axis.title.x= element_blank(),
axis.title.y = element_text(size =10, color ='black'),
axis.text.x = element_text(size =10, color ='black'),
axis.text.y = element_text(size =8, color = 'black'))+
scale_color_manual(name = 'Field Type', labels = c('Native', 'Non-virgin', 'Virgin'),
values = c('tomato', 'orange', 'chartreuse4'))+
facet_wrap(~location)
beta
beta = ggplot(labels, aes(x = ord$points[,1], y = ord$points[,2],
color = FieldType, shape = location))+
geom_point(size = 2)+
labs(x = 'NMDS 1', y="NMDS 2") +
theme(axis.title.x= element_blank(),
axis.title.y = element_text(size =10, color ='black'),
axis.text.x = element_text(size =10, color ='black'),
axis.text.y = element_text(size =8, color = 'black'))+
scale_color_manual(name = 'Field Type', labels = c('Native', 'Non-virgin', 'Virgin'),
values = c('tomato', 'orange', 'chartreuse4'))+
facet_wrap(~location)
beta
beta = ggplot(labels, aes(x = ord$points[,1], y = ord$points[,2],
color = FieldType, shape = location))+
geom_point(size = 2)+
labs(x = 'NMDS 1', y="NMDS 2") +
theme(axis.title.x= element_blank(),
axis.title.y = element_text(size =10, color ='black'),
axis.text.x = element_text(size =10, color ='black'),
axis.text.y = element_text(size =8, color = 'black'))+
scale_color_manual(name = 'Field Type', labels = c('Native', 'Non-virgin', 'Virgin'),
values = c('tomato', 'orange', 'chartreuse4'))+
beta
beta = ggplot(labels, aes(x = ord$points[,1], y = ord$points[,2],
color = FieldType, shape = location))+
geom_point(size = 2)+
labs(x = 'NMDS 1', y="NMDS 2") +
theme(axis.title.x= element_blank(),
axis.title.y = element_text(size =10, color ='black'),
axis.text.x = element_text(size =10, color ='black'),
axis.text.y = element_text(size =8, color = 'black'))+
scale_color_manual(name = 'Field Type', labels = c('Native', 'Non-virgin', 'Virgin'),
values = c('tomato', 'orange', 'chartreuse4'))
beta
beta = ggplot(labels, aes(x = ord$points[,1], y = ord$points[,2],
color = FieldType, shape = location))+
geom_point(size = 2)+
labs(x = 'NMDS 1', y="NMDS 2") +
theme(axis.title.x= element_text(size =10, color ='black'),
axis.title.y = element_text(size =10, color ='black'),
axis.text.x = element_text(size =10, color ='black'),
axis.text.y = element_text(size =8, color = 'black'))+
scale_color_manual(name = 'Field Type', labels = c('Native', 'Non-virgin', 'Virgin'),
values = c('tomato', 'orange', 'chartreuse4'))+theme_bw()
beta
#jpeg('Tuberwt_gt20_222_combinedlocations.jpg',width=5,height=3,units='in',res=300)
beta = ggplot(labels, aes(x = ord$points[,1], y = ord$points[,2],
color = FieldType, shape = location))+
geom_point(size = 2)+
labs(x = 'NMDS 1', y="NMDS 2") +
theme(axis.title.x= element_text(size =10, color ='black'),
axis.title.y = element_text(size =10, color ='black'),
axis.text.x = element_text(size =10, color ='black'),
axis.text.y = element_text(size =8, color = 'black'))+
scale_color_manual(name = 'Field Type', labels = c('Native', 'Non-virgin', 'Virgin'),
values = c('tomato', 'orange', 'chartreuse4'))+theme_bw()+
stat_ellipse(aes(group = FieldType), linetype = 2)
beta
#jpeg('Tuberwt_gt20_222_combinedlocations.jpg',width=5,height=3,units='in',res=300)
beta = ggplot(labels, aes(x = ord$points[,1], y = ord$points[,2], color = FieldType))+
geom_point(size = 2)+
labs(x = 'NMDS 1', y="NMDS 2") +
theme(axis.title.x= element_blank(),
axis.title.y = element_text(size =10, color ='black'),
axis.text.x = element_text(size =10, color ='black'),
axis.text.y = element_text(size =8, color = 'black'))+
scale_color_manual(name = 'Field Type', labels = c('Native', 'Non-virgin', 'Virgin'),
values = c('tomato', 'orange', 'chartreuse4'))+
facet_wrap(~location)+stat_ellipse(aes(group = FieldType), linetype = 2)
beta
options(repr.plot.width = 5, repr.plot.height = 20)
#jpeg('Alpha diveristy.jpg',width=5,height=3,units='in',res=300)
b= ggplot(data = diversity, aes(x =FieldType, y = Shannon, color = FieldType))+
geom_boxplot(outlier.color = NA)+
geom_jitter(aes(color = FieldType), height = 0, width = .2)+
labs(x = 'Field Type', y="Shannon's diversity index") +
theme(legend.position = "none")+
theme(axis.title.x= element_blank(),
axis.title.y = element_text(size =10, color ='black'),
axis.text.x = element_text(size =10, color ='black'),
axis.text.y = element_text(size =8, color = 'black'))+
scale_color_manual(name = 'Field Type', labels = c('Native', 'Non-Virgin', 'Virgin'),
values = c('tomato', 'orange', 'chartreuse4'))+facet_wrap(~ location)
b
#dev.off()
library(phyloseq)
library('picante')
ord = metaMDS(log_rare, distance = 'bray')
options(repr.plot.width = 5, repr.plot.height = 3)
#jpeg('Tuberwt_gt20_222_combinedlocations.jpg',width=5,height=3,units='in',res=300)
beta = ggplot(labels, aes(x = ord$points[,1], y = ord$points[,2],
color = FieldType, shape = location))+
geom_point(size = 2)+
labs(x = 'NMDS 1', y="NMDS 2") +
theme(axis.title.x= element_text(size =10, color ='black'),
axis.title.y = element_text(size =10, color ='black'),
axis.text.x = element_text(size =10, color ='black'),
axis.text.y = element_text(size =8, color = 'black'))+
scale_color_manual(name = 'Field Type', labels = c('Native', 'Non-virgin', 'Virgin'),
values = c('tomato', 'orange', 'chartreuse4'))+theme_bw()+
stat_ellipse(aes(group = FieldType), linetype = 2)
beta
#dev.off()
fit_shannon = lmer(Shannon ~ FieldType + (1|location), data = diversity)
summary(fit_shannon)
pairwise.wilcox.test(diversity$Shannon,
diversity$FieldType,
p.adjust.method = "BH")
wilcox.observed = pairwise.wilcox.test(diversity$Shannon,
diversity$FieldType,
p.adjust.method = "BH")
wilcox.observed$p.value
ord = metaMDS(log_rare, distance = 'bray')
options(repr.plot.width = 5, repr.plot.height = 3)
jpeg('Beta_biplot.jpg',width=5,height=3,units='in',res=300)
beta = ggplot(labels, aes(x = ord$points[,1], y = ord$points[,2],
color = FieldType, shape = location))+
geom_point(size = 2)+
labs(x = 'NMDS 1', y="NMDS 2") +
theme(axis.title.x= element_text(size =10, color ='black'),
axis.title.y = element_text(size =10, color ='black'),
axis.text.x = element_text(size =10, color ='black'),
axis.text.y = element_text(size =8, color = 'black'))+
scale_color_manual(name = 'Field Type', labels = c('Native', 'Non-virgin', 'Virgin'),
values = c('tomato', 'orange', 'chartreuse4'))+theme_bw()+
stat_ellipse(aes(group = FieldType), linetype = 2)
beta
dev.off()
beta
ord = metaMDS(log_rare, distance = 'bray')
options(repr.plot.width = 5, repr.plot.height = 3)
jpeg('Beta2.jpg',width=5,height=3,units='in',res=300)
beta = ggplot(labels, aes(x = ord$points[,1], y = ord$points[,2], color = FieldType))+
geom_point(size = 2)+
labs(x = 'NMDS 1', y="NMDS 2") +
theme(axis.title.x= element_blank(),
axis.title.y = element_text(size =10, color ='black'),
axis.text.x = element_text(size =10, color ='black'),
axis.text.y = element_text(size =8, color = 'black'))+
scale_color_manual(name = 'Field Type', labels = c('Native', 'Non-virgin', 'Virgin'),
values = c('tomato', 'orange', 'chartreuse4'))+
facet_wrap(~location)+stat_ellipse(aes(group = FieldType), linetype = 2)
beta
dev.off()
beta
# and calculating our Euclidean distance matrix
euc_dist <- dist(log_rare)
length(euc_dist)
euc_clust <- hclust(euc_dist, method="ward.D2")
# plot(euc_clust) # hclust objects like this can be plotted as is, but i like to change them to dendrograms for two reasons:
# 1) it's easier to color the dendrogram plot by groups
# 2) if you want you can rotate clusters with the rotate() function of the dendextend package
euc_dend <- as.dendrogram(euc_clust, hang=0.1)
plot(euc_dend, ylab="VST Euc. dist.")
dist = phyloseq::distance(log_rare, method="bray")
adon.results<-adonis(dist ~ labels$FieldType, strata = labels$location)
adon.results$aov.tab
permanova_pairwise$aov.tab$`Pr(>F)`[1]
dist = phyloseq::distance(log_rare, method="bray")
permanova_pairwise<-adonis(dist ~ labels$FieldType, strata = labels$location)
permanova_pairwise
permanova_pairwise$aov.tab$`Pr(>F)`[1]
dist = phyloseq::distance(log_rare, method="bray")
permanova_pairwise<-adonis(dist ~ labels$FieldType, strata = labels$location)
permanova_pairwise$aov.tab$`Pr(>F)`[1]
#Generate distance matrix
clr_dist_matrix <- phyloseq::distance(log_rare, method = "euclidean")
#ADONIS test
adon.results<-adonis(clr_dist_matrix ~ labels$FieldType, strata = labels$location)
adon.results$aov.tab
permanova_pairwise$aov.tab
ordination = ordinate(log_rare, method="NMDS", distance=dist)
plot_ordination(labels, ordination, color="FieldType") +
theme_classic() +
theme(strip.background = element_blank())
plot_ordination(labels, ordination, color="FieldType")
plot_ordination(color="FieldType")
ordiantion
ordination
plot(ordination)
ordination$points
ordination$points[,1]
ordination = ordinate(log_rare, method="NMDS", distance=dist)
ggplot(labels, aes(x = ordination$points[,1], y = ordination$points[,2],
color = FieldType, shape = location))+
geom_point(size = 2)+
labs(x = 'NMDS 1', y="NMDS 2") +
theme(axis.title.x= element_text(size =10, color ='black'),
axis.title.y = element_text(size =10, color ='black'),
axis.text.x = element_text(size =10, color ='black'),
axis.text.y = element_text(size =8, color = 'black'))+
scale_color_manual(name = 'Field Type', labels = c('Native', 'Non-virgin', 'Virgin'),
values = c('tomato', 'orange', 'chartreuse4'))+theme_bw()+
stat_ellipse(aes(group = FieldType), linetype = 2)
ord = metaMDS(log_rare, distance = 'bray')
options(repr.plot.width = 5, repr.plot.height = 3)
#jpeg('Beta_biplot.jpg',width=5,height=3,units='in',res=300)
beta = ggplot(labels, aes(x = ord$points[,1], y = ord$points[,2],
color = FieldType, shape = location))+
geom_point(size = 2)+
labs(x = 'NMDS 1', y="NMDS 2") +
theme(axis.title.x= element_text(size =10, color ='black'),
axis.title.y = element_text(size =10, color ='black'),
axis.text.x = element_text(size =10, color ='black'),
axis.text.y = element_text(size =8, color = 'black'))+
scale_color_manual(name = 'Field Type', labels = c('Native', 'Non-virgin', 'Virgin'),
values = c('tomato', 'orange', 'chartreuse4'))+theme_bw()+
stat_ellipse(aes(group = FieldType), linetype = 2)
beta
#dev.off()
#Dispersion test and plot
dispr <- vegan::betadisper(clr_dist_matrix)
#Dispersion test and plot
dispr <- vegan::betadisper(clr_dist_matrix, labels$FieldType)
dispr
plot(dispr, main = "Ordination Centroids and Dispersion Labeled: Aitchison Distance", sub = "")
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
library(ggplot2)
library(raster)
library(agricolae)
library(tidyr)
library(ggpubr)
library(dplyr)
library(tidyverse)
library(data.table)
library(vegan)
library(lme4)
library(lmerTest)
df = read_csv(file = 'C:/Users/theox/Desktop/Projects/SoilFingerPrints/Data/SamplingLocations/SamplingLocations.csv')
df = df[c('ID', 'lat', 'long', 'FieldType')]
head(df)
df$FieldType = gsub('Field', "", df$FieldType)
df$FieldType = gsub('field', "", df$FieldType)
df$FieldType = gsub('Non-virgin ', "Non-virgin", df$FieldType)
df$FieldType = gsub('Virgin ', "Virgin", df$FieldType)
unique(df$FieldType)
state_list    <- c('California', 'Nevada', 'Utah', 'Wyoming',
'Montana', 'Idaho', 'Oregon', 'Washington')
province_list <- c("British Columbia", "Alberta")
us <- getData("GADM",country="USA",level=1)
state_list    <- c('California', 'Nevada', 'Utah', 'Wyoming',
'Montana', 'Idaho', 'Oregon', 'Washington')
province_list <- c("British Columbia", "Alberta")
us <- raster::getData("GADM",country="USA",level=1)
canada <- getData("GADM",country="CAN",level=1)
state_list    <- c('California', 'Nevada', 'Utah', 'Wyoming',
'Montana', 'Idaho', 'Oregon', 'Washington')
province_list <- c("British Columbia", "Alberta")
us <- raster::getData("GADM",country="USA",level=1)
canada <- raster::getData("GADM",country="CAN",level=1)
us.states <- us[us$NAME_1 %in% state_list,]
ca.provinces <- canada[canada$NAME_1 %in% province_list,]
